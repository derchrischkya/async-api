services:
  nsqlookupd:
    image: nsqio/nsq
    command: /nsqlookupd
    ports:
      - "4160:4160"
      - "4161:4161"
    healthcheck:
      test: curl --fail http://nsqlookupd:4161/ping || exit 1
      interval: 5s
      timeout: 10s
      retries: 3
      start_period: 10s
  nsqd:
    image: nsqio/nsq
    command: /nsqd --broadcast-address=nsqd --lookupd-tcp-address=nsqlookupd:4160
    links:
      - nsqlookupd
    ports:
      - "4150:4150"
      - "4151:4151"
  nsqadmin:
    image: nsqio/nsq
    command: /nsqadmin --lookupd-http-address=nsqlookupd:4161
    links:
      - nsqlookupd
    ports:
      - "4171:4171"
  nsq_to_file:
    image: nsqio/nsq
    command: /nsq_to_file --topic=test --output-dir=/data --lookupd-http-address=nsqlookupd:4161
    volumes:
      - /tmp/data:/data
    links:
      - nsqd
    depends_on:
      - nsqd
  # mytest:
  #   image: curlimages/curl
  #   command: sh /test/get-nsq-running.sh
  #   volumes:
  #     - /Users/christoph/git/async-api/message-systems/nsq/tests/:/test/
  #   depends_on:
  #     nsqlookupd:
  #       condition: service_started
